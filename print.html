<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MDRC Pacbot</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-0a5e2b11.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-b383d423.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">MDRC Pacbot</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="welcome"><a href="#welcome" class="header">Welcome</a></h1>
<p>Welcome to Pacbot!</p>
<p>We are part of RIT‚Äôs Multi-Disciplinary Robotics Club, a student-led organization that aims to teach, create,
and manage robotics projects, using skills learned across electrical, mechanical, and software engineering. Pacbot
requires collaboration across all three disciplines.</p>
<p>Our team focuses on developing a small fully autonomous robot to play the arcade game Pac-Man on a physical field.
Our annual competition is in April, where we compete against other Pacbot teams from various universities. A
picture of our competition board can be found <a href="https://drive.google.com/file/d/1iVqpCv0Rxv8A2_7jpsx35VPjnoLUcA_p/view?usp=drive_link">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="the-history-of-the-rit-pacbot-team"><a class="header" href="#the-history-of-the-rit-pacbot-team">The History of the RIT Pacbot Team</a></h1>
<p>The Rochester Institute of Technology (RIT) Pacbot team is a part of the RIT Robotics Club, also known as MDRC. The team participates in the annual Pacbot competition, where autonomous robots navigate a maze to collect pellets and evade or capture ghosts. This document chronicles the history of the RIT Pacbot team, drawing from a team meeting held on May 2, 2025, following the competition hosted at RIT on April 19, 2025.</p>
<p>The RIT Pacbot team‚Äôs participation in the competition dates back to its early years. Quinn Tucker, who joined RIT in the fall of 2019, recalled being told about the team‚Äôs unexpected victory in the 2019 Pacbot competition. Ben Giacalone, also a freshman in 2019, corroborated this, describing it as a win achieved through ‚Äúcomplete accent.‚Äù At that time, the robots from various teams were generally unreliable, and their artificial intelligence (AI) capabilities were rudimentary, primarily relying on heuristic approaches. The RIT robot that secured the first-place finish was described as being hastily assembled the night before the competition and barely functional.</p>
<p>Following this surprising success, the team faced challenges in subsequent years. The onset of the COVID-19 pandemic in 2020 significantly disrupted the competition schedule, with the Pacbot competition being canceled in 2020 and likely in 2021 as well. This period of uncertainty led to demotivation among some team members. Despite the lack of competitions, the team continued to work on their robot and AI, though progress on the physical robot was slow, with early prototypes being simple box-shaped designs that lacked effective movement.</p>
<p>The team‚Äôs efforts gained renewed momentum in 2023 when the Pacbot competition was reinstated. Ben Giacalone, who had been exploring reinforcement learning (RL) algorithms, rejoined the team with the goal of applying these techniques to the robot‚Äôs high-level AI. After considerable experimentation, the team achieved a breakthrough, developing an RL-based AI that outperformed their previous heuristic methods. This marked a significant advancement in the team‚Äôs approach to the competition.</p>
<p>In the fall of 2023, Quinn Tucker undertook an independent study under Dr. Zhao, focusing on implementing various RL algorithms for the Pacbot challenge. This effort, partly motivated by gaining academic credit for his work on the team, saw the exploration of Deep Q Network (DQN), Proximal Policy Optimization (PPO), and AlphaZero algorithms. While AlphaZero proved computationally intensive, the DQN agent ultimately demonstrated the best performance and became the foundation for the team‚Äôs high-level policy in subsequent competitions. Ben Giacalone played a crucial role in guiding Quinn with the fundamentals of reinforcement learning during this period.</p>
<p>Michael Elia joined the team as a freshman in 2022. Under the leadership of Christian Guerrero, the team initially focused on heuristic-based AI. However, progress in this area was disappointing, with the models frequently encountering simple scenarios they couldn‚Äôt navigate effectively. The team did attempt to build a robot that year, but it remained unfinished due to incomplete electronics.</p>
<p>The 2023-2024 academic year saw Michael, Quinn, and Ben Giacalone, all software-focused, attempt to build a robot. This endeavor proved unsuccessful, with the resulting robot unable to move. This experience highlighted the necessity of dedicated hardware expertise within the team.</p>
<p>The arrival of Brian Doolin, with a background in BattleBots, proved to be a turning point for the team‚Äôs hardware capabilities. Brian introduced Onshape, a collaborative CAD software, to streamline the robot design process. He was tasked with creating the smallest possible robot, leading to the current three-wheeled omni-drive design, which fits within a five-inch diameter circle. This design prioritized compactness to navigate the seven-inch wide passages of the competition arena, a lesson learned from past robots getting stuck. The robot features a top shell, a mount for a screen (used for software debugging), a battery, and three motors in a triangular configuration to ensure consistent ground contact and encoder accuracy. The team utilizes Pico boards and a custom-designed PCB, referred to as a ‚Äúhat,‚Äù for motor control, power distribution, and sensor connections. This PCB, designed by Michael Elia using EasyEDA software, significantly improved the organization and reduced the size of the robot‚Äôs electronics compared to earlier wire-based setups and proto boards.</p>
<p>The robot is equipped with several types of sensors. Encoders on each wheel provide data on wheel speed and position. Initially, the team used infrared distance sensors, which were unreliable. They then transitioned to time-of-flight sensors, which offered improved accuracy. The current model of time-of-flight sensors can detect objects as close as one millimeter, though their effective range is limited by the cone of light they emit hitting the arena floor. To address the robot‚Äôs orientation, the team incorporated an Inertial Measurement Unit (IMU) featuring an accelerometer, gyroscope, and magnetometer. While the magnetometer proved too noisy for reliable use, the accelerometer and gyroscope provide accurate rotational data, crucial for localization.</p>
<p>Localization, determining the robot‚Äôs position within the maze, has been a significant challenge. In 2023-2024, Quinn Tucker developed a particle filter-based localization system implemented in Rust. While theoretically sound, this approach proved computationally expensive and struggled with inaccuracies stemming from the computer vision (CV) system‚Äôs lag in tracking the robot‚Äôs position. Despite this limitation, the robot performed well in simulation and even achieved second place in one practice run at the 2024 competition, scoring higher than any previous team. However, the CV lag hampered its performance in official runs.</p>
<p>Following the 2024 competition, Michael Elia initiated a significant restructuring of the team‚Äôs codebase, breaking it into modular crates within the MDRC Pacbot repository on GitHub. The particle filter was not ported to this new system due to its performance issues. Instead, the team shifted towards a stateless localization approach for the 2024-2025 season. Ben Brodeur played a key role in developing this new system, which initially involved raycasting based on CV location and sensor readings. However, this was prone to errors when the robot‚Äôs rotation deviated. The final stateless localization method adopted involved comparing sensor readings to expected values at discrete locations within the maze grid and selecting the most likely location based on proximity to the CV data and a point system. This simpler, computationally efficient algorithm could run directly on the robot, eliminating the delay associated with off-robot processing.</p>
<p>The 2025 competition, hosted at RIT, saw the team achieve first place, with UIUC, who won their own competition, not attending the RIT event. The team also showcased their custom-built competition field, constructed from MDF boards using the club‚Äôs CNC router.</p>
<p>Looking to the future, Ben Brodeur, the team lead for the next year, outlined several areas for improvement. Enhancing the accuracy of localization remains a priority, potentially by re-exploring state-based methods to address sensor range limitations in long corridors. Improving low-level motor control by incorporating feed-forward terms alongside PID control is also seen as important for smoother movements and preventing the robot from getting stuck.</p>
<p>The team also discussed potential hardware upgrades. While a suspension system was deemed overly complex, exploring flexible 3D-printed mounts or rubber dampeners could help mitigate vibrations. Considering motors with perpendicular axles could further reduce the robot‚Äôs footprint. The reliability of the current brushed DC motors, which occasionally fail due to brush disintegration, is also a factor to consider for future iterations.</p>
<p>A recurring ‚Äúbad idea,‚Äù jokingly raised by Quinn Tucker, was to train the reinforcement learning model directly on the physical robot instead of in simulation, a proposition deemed impractical due to the potential for damage and inefficiency. Another explored but ultimately discarded concept was to have the reinforcement learning model control the low-level motor commands directly. The consensus was that hand-coded motor control, possibly incorporating model-based control techniques, would be more effective.</p>
<p>The team acknowledges the significant progress made over the years, from a barely functional robot to a competition-winning design and the ability to host their own event. The current success is attributed to the dedication and hard work of numerous team members, particularly the graduating seniors Michael Elia and Brian Doolin, as well as the contributions of alumni like Quinn Tucker and Ben Giacalone. As Michael Elia prepares to hand over the team leadership to Ben Brodeur, there is a sense of pride in past achievements and optimism for the future of the RIT Pacbot team. The wealth of knowledge and experience accumulated within the team, documented in their GitHub repository and the memories of its members, will serve as a valuable resource for future generations of RIT students who take on the challenge of autonomous Pacbot navigation.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rust-api"><a class="header" href="#rust-api">Rust API</a></h1>
<p>Our code is done entirely in Rust, a modern systems programmings language focused on speed and memory safety. If you
don‚Äôt know Rust, check out <a href="https://doc.rust-lang.org/book/">The Rust Book</a>.</p>
<p>You can read more about each crate in the repository Readme.</p>
<p>Auto-generated documentation for the Rust code can be found at <a href="https://rit-mdrc.github.io/mdrc-pacbot/api/core_pb/">https://rit-mdrc.github.io/mdrc-pacbot/api/core_pb/</a></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="game"><a href="#game" class="header">Game</a></h1>
<p>The rules of the competition can be found here: <a href="https://docs.google.com/document/d/1S_LQgnrct9sxjBMF8caiuIUB6S4VU-Ep4F8Lx8vzH5Y/edit?usp=sharing">https://docs.google.com/document/d/1S_LQgnrct9sxjBMF8caiuIUB6S4VU-Ep4F8Lx8vzH5Y/edit?usp=sharing</a></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="grid"><a class="header" href="#grid">Grid</a></h1>
<ul>
<li><a href="#grid--coordinate-system">Grid &amp; Coordinate System</a>: The 2D structure <code>Grid</code> and the corresponding coordinate system</li>
<li><a href="#computed-grid">Computed Grid</a>: The utility structure <code>ComputedGrid</code> built around <code>Grid</code> that provides pre-calculated information</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="grid--coordinate-system"><a class="header" href="#grid--coordinate-system">Grid &amp; Coordinate System</a></h1>
<h2 id="grid-1"><a class="header" href="#grid-1"><code>Grid</code></a></h2>
<p>Pacman is played on a 2D integer grid, meaning the location of all objects
(including walls, ghosts, pellets, and Pacman) can be fully described with
two integers.</p>
<p>The <code>Grid</code> data type, an alias for <code>[[bool; GRID_COLS]; GRID_ROWS]</code> provides information about which cells are walls.</p>
<p><code>Grid</code> is <code>GRID_ROWS</code> x <code>GRID_COLS</code> size. The official Pacbot grid
is 28 cells 31 cells, but this code currently supports up to 32 x 32 grids.
Any coordinate less than (0, 0) or greater than (31, 31) is treated as a wall, and is not stored in <code>Grid</code>.</p>
<h2 id="standard-grids"><a class="header" href="#standard-grids">Standard Grids</a></h2>
<p>A number of standard grids are provided in <code>core_pb::grid::standard_grid</code>. These include several
common configurations:</p>
<ul>
<li><code>GRID_PACMAN</code> - The official Pacbot <code>Grid</code></li>
<li><code>GRID_BLANK</code> - A <code>Grid</code> entirely composed of walls (except for the space at (1, 1)), copy-paste-able to create new <code>Grid</code>s</li>
<li><code>GRID_OUTER</code> - A <code>Grid</code> with an empty pathway around the inside of the outer edge</li>
<li><code>GRID_PLAYGROUND</code> - A <code>Grid</code> with many small areas for testing motor control algorithms</li>
</ul>
<p>These can be used as-is or edited to create custom <code>Grid</code>s. However, most parts of the application do not support <code>Grid</code>s
outside the <code>StandardGrid</code>s.</p>
<h3 id="upgrading-to-computedgrid"><a class="header" href="#upgrading-to-computedgrid">Upgrading to <code>ComputedGrid</code></a></h3>
<p>The <a href="#computed-grid">ComputedGrid</a> struct provides additional pre-calculated information about <code>Grid</code>s.
The section <a href="#grid-rules">Grid Rules</a> contains more information about special rules, like that a <code>Grid</code> must have
Walls around the entire outer edge, among others.</p>
<p>Once a <code>Grid</code> is upgraded to a <code>ComputedGrid</code> via <code>ComputedGrid::try_from(grid)</code>, which is necessary for many other parts of this library, it becomes
immutable.</p>
<h2 id="coordinates"><a class="header" href="#coordinates">Coordinates</a></h2>
<p>Throughout <code>mdrc_pacbot</code>, we use <code>nalgebra::Point2</code> as much as possible to describe location. This has two properties,
<code>x</code> and <code>y</code>. <em>Most of the time</em>, we use the same coordinate system you‚Äôve used in math class for many years:</p>
<pre><code class="language-ignore">+y; 90¬∞     (31, 31)
 ü°ë     
 |     (...)
 |
(0, 0)-----ü°í +x; 0¬∞
</code></pre>
<p>where <code>+x</code> and 0¬∞ is to the right, <code>+y</code> is up, and angle is more positive in the counter-clockwise direction. Using
this system, angle functions like sin and cos behave as expected.</p>
<p>The only downside to this system is that it differs from the official Pacbot Pac-Man implementation. There, they
use <code>row</code> and <code>col</code>, with coordinates in the form <code>(row, col)</code>, with the intended orientation like so:</p>
<pre><code class="language-ignore">(0, 0)    --&gt; +col
       
 |    (...)
 v
+row       (31, 31)
</code></pre>
<p>We choose not to do this because it places (0, 0) at the top left which makes physics calculations confusing. So we
rotate the official game by 90¬∞ and translate <code>(row, col)</code> to <code>(x, y)</code>. If you want to view the grid without the rotation,
click the ‚ÄúRotated Grid‚Äù checkbox in the gui.</p>
<p>On the official Pacbot grid (in either rotation):</p>
<ul>
<li>(1, 1)   is the top    left  walkable corner</li>
<li>(1, 26)  is the top    right walkable corner</li>
<li>(29, 1)  is the bottom left  walkable corner</li>
<li>(29, 26) is the top    right walkable corner</li>
</ul>
<p>Pacbot‚Äôs starting position is (23, 13), facing right.</p>
<h2 id="physical-coordinates"><a class="header" href="#physical-coordinates">Physical Coordinates</a></h2>
<p>The integer coordinate system described above is easily extendable to a physical floating point
coordinate system.</p>
<p>When points are given as floating point values, integer coordinates (like 1.0, 1.0) represent
the center of the corresponding <code>Grid</code> cell (in this case, (1, 1)).</p>
<p>Note that walls in the physical Pacbot grid are ‚Äúeroded‚Äù by half a cell so that paths are two
<code>Grid</code> cells wide. This is why, except for the outer edge, there can‚Äôt be a wall in <code>Grid</code> that is one cell
wide - both sides would get eroded by half a cell and there would be an infinitely thin wall.</p>
<p>Curiously, this results in the edges of walls falling on integer coordinates that lie at the center
of the <code>Grid</code> cells that are declared as walls.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="computed-grid"><a class="header" href="#computed-grid">Computed Grid</a></h1>
<p><code>ComputedGrid</code> provides additional information about a <code>Grid</code> that is calculated when
the <code>ComputedGrid</code> is first created, meaning it is very cheap to retrieve.</p>
<p>For this documentation, a ‚Äúwalkable space‚Äù is one where Pacman can travel.</p>
<h2 id="grid-rules"><a class="header" href="#grid-rules">Grid Rules</a></h2>
<p>In order for a <code>Grid</code> to be successfully upgraded to a <code>ComputedGrid</code> via <code>ComputedGrid::try_from(grid)</code>,
all of the following must be true:</p>
<ul>
<li>All the cells around the outside of the grid (with <code>x</code> or <code>y</code> equal to 0 or 31) are walls</li>
<li>There is at least one walkable cell (where Pacman can spawn)</li>
<li>There are no 2x2 empty squares</li>
<li>There is no wall with a walkable space both above and below it</li>
<li>There is no wall with a walkable space both to the left and right</li>
</ul>
<p>The last two points can be simplified to say that all walls are 2 cells thick.</p>
<p>Note:</p>
<ul>
<li>It is not necessary that a <code>ComputedGrid</code> is connected, or that every walkable space is accessible from every other one</li>
</ul>
<h2 id="pre-computed-information"><a class="header" href="#pre-computed-information">Pre-computed Information</a></h2>
<p>When a <code>ComputedGrid</code> is constructed, it spends extra time calculating a number of variables related to
the game grid. This information is documented in the <a href="https://rit-mdrc.github.io/mdrc-pacbot-util/api/mdrc_pacbot_util/grid/struct.ComputedGrid.html">ComputedGrid documentation</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="network"><a href="#network" class="header">Network</a></h1>
<pre class="mermaid">---
title: RIT MDRC Pacbot Network Architecture (github.com/RIT-MDRC/mdrc-pacbot)
---
flowchart LR
    subgraph Legend
        direction TB
        Y(GUI):::gui
        Z(Game Server):::game_server
        X(Robot):::robot
    end
    %% ensure the legend is vertical
    Y ~~~ A 
    subgraph "mdrc-pacbot"
        A(WASM GUIs):::gui &amp; B(Rust GUIs):::gui &lt;--&gt;|Websocket| D{MDRC Pacbot Server\nserver_pb}
        D &lt;--&gt;|TCP| E(Raspberry Pi Picos):::robot
        D &lt;--&gt;|TCP| F(Simulated Robots):::robot
        D &lt;--&gt;|Websocket| J(Simulation Manager)
        I(Rust Game Server):::game_server &lt;--&gt;|Websocket| D
        subgraph gui_pb
            A
            B
        end
        subgraph pico_pb
            E
        end
        subgraph sim_pb
            I
            J
            F
        end
    end
    subgraph "Pacbot-2 (github.com/Pacbot-Competition/Pacbot-2)"
        C(Competition GUIs):::gui &lt;--&gt;|Websocket| G(Official Go Game Server):::game_server
    end
    C &lt;--&gt;|Websocket| I
    G &lt;--&gt;|Websocket| D

    classDef gui stroke:#f00
    classDef game_server stroke:#0f0
    classDef robot stroke:#ff0
</pre>

<div style="break-before: page; page-break-before: always;"></div>
<h1 id="localization"><a class="header" href="#localization">Localization</a></h1>
<p>The RIT pacbot team‚Äôs localization requires 4 sensors, each facing in a cardinal direction (right, up, left
down). The sensors have a range that extends half the distance of the longest corridor of the grid.</p>
<h2 id="general-steps"><a class="header" href="#general-steps">General Steps</a></h2>
<ol>
<li>First Pass Prediction</li>
<li>Second Pass Prediction</li>
<li>Combine Directional Information</li>
</ol>
<h2 id="first-pass-prediction"><a class="header" href="#first-pass-prediction">First Pass Prediction</a></h2>
<p>The <code>cv_location</code> passed into the localizer function is a rough estimate of where pacbot is on the grid. To
get an initial estimate of where pacbot is based on sensor data, a raycast is performed in each of the
cardinal directions from the <code>cv_location</code>.</p>
<pre><code class="language-ignore">fn get_sim_ray_cast(loc: Point2&lt;i8&gt;, grid: &amp;Grid, radius: f32) -&gt; [f32; 4] {
    VECTORS.map(|dir| {
        let mut dist: i8 = 0;
        let mut p = loc;
        let dir = dir.map(|x| x as i8);

        while !wall_at(grid, p) {
            p += dir;
            dist += 1;
        }

        dist as f32 - radius
    })
}
</code></pre>
<p>For the first prediction, an assumption is made: the walls that are hit by the actual sensors are the same
walls hit by the corresponding raycasts from <code>cv_location</code>. This assumption is not always true given the inaccuracy of <code>cv_location</code>, but can be fixed in the second pass prediction. Knowing this, each of the
sensors can give an estimate of pacbot‚Äôs location on the corresponding axis by simply adding the raycast
vector and subtracting the sensor vector.</p>
<pre><code class="language-ignore">fn get_estimated_poses(
    grid: &amp;Grid,
    cv_location: Point2&lt;i8&gt;,
    distance_sensors: &amp;[Result&lt;Option&lt;f32&gt;, ()&gt;; 4],
    radius: f32,
) -&gt; [Option&lt;Point2&lt;f32&gt;&gt;; 4] {
    let cv_distances = get_sim_ray_cast(cv_location, grid, radius);
    let cv_location = cv_location.map(|x| x as f32);

    [0, 1, 2, 3].map(|i| {
        distance_sensors[i]
            .ok()
            .flatten()
            .map(|dist| cv_location + (VECTORS[i] * (cv_distances[i] - dist)))
    })
}
</code></pre>
<p>Although the first prediction may be incorrect, the information from the estimated poses allows for
error correction.</p>
<h2 id="second-pass-prediction"><a class="header" href="#second-pass-prediction">Second Pass Prediction</a></h2>
<p>Once an estimated position is created from each of the sensors, each axis is checked to determine if it
actually hit the wall that was hit by the <code>cv_location</code> raycast. The check is done by observing if the
predicted position is different from <code>cv_location</code> by more than <code>CV_ERROR</code>. If the estimation is off
by more than <code>CV_ERROR</code> for both directions along an axis (right and left or up and down), then we must perform the second pass operation.</p>
<p>Before describing how the second pass works, it is important to understand that if one of the axis
has incorrect values for both sensors, then the other axis must have a correct value. This property
is a product of the grid, which requires pacbot to travel in a cardinal direction and also prevents it from
travelling diagonally through any corridors. Requiring at least one sensor to hit the same wall as
the <code>cv_location</code> raycast is essential for the second pass localization to correct the errors from
the first pass.</p>
<p>For the second pass, the program must find a position to raycast from in which the rays hit the same walls
that the sensors do. To do so, we check the position given by the axis that gives a position within <code>CV_ERROR</code>. If this position has a greater value along the axis as the <code>cv_location</code>, then we must raycast
again from one unit above the original <code>cv_location</code> on the corresponding axis. If the position has a lower value along the axis as the <code>cv_location</code>, then we must raycast again from one unit below the original <code>cv_location</code> on the corresponding axis. Once <code>new_location</code> is found, repeat the operations of the first
pass with <code>new_location</code> in place of <code>cv_location</code>. Since the assumption that was made is now true
(the rays hit the same walls as the sensors), the operation should give the correct position.</p>
<pre><code class="language-ignore">if [poses[0], poses[2]].iter().all(|x| {
        x.map(|pos| get_dist(pos, cv_location_f32) &gt; CV_ERROR)
            .unwrap_or(true)
    }) {
        let mut new_location = cv_location_int;
        if let Some(pos) = [poses[1], poses[3]].into_iter().flatten().next() {
            if pos.y &gt; cv_location_f32.y {
                new_location.y += 1;
            } else {
                new_location.y -= 1;
            }
            poses = get_estimated_poses(&amp;grid, new_location, distance_sensors, robot.radius);
        }
    }

if [poses[1], poses[3]].iter().all(|x| {
    x.map(|pos| get_dist(pos, cv_location_f32) &gt; CV_ERROR)
        .unwrap_or(true)
}) {
    let mut new_location = cv_location_int;
    if let Some(pos) = [poses[0], poses[2]].into_iter().flatten().next() {
        if pos.x &gt; cv_location_f32.x {
            new_location.x += 1;
        } else {
            new_location.x -= 1;
        }
        poses = get_estimated_poses(&amp;grid, new_location, distance_sensors, robot.radius);
    }
}
</code></pre>
<h2 id="combine-directional-information"><a class="header" href="#combine-directional-information">Combine Directional Information</a></h2>
<p>The program integrates all of the sensor data by simply using one of the two sensors for each of the axis.
It prioritizes the values closest to <code>cv_location</code> and values that are not <code>None</code> or <code>Err()</code> for each axis.
If both sensors are not functional or do not detect a wall, that axis will remain whatever is given by
<code>cv_location</code>.</p>
<pre><code class="language-ignore">let x = [poses[0], poses[2]]
        .into_iter()
        .flatten()
        .min_by_key(|pos| {
            NotNan::new(get_dist(*pos, cv_location_f32)).unwrap_or(NotNan::new(0.0).unwrap())
        })
        .unwrap_or(cv_location_f32)
        .x;

let y = [poses[1], poses[3]]
    .into_iter()
    .flatten()
    .min_by_key(|pos| {
        NotNan::new(get_dist(*pos, cv_location_f32)).unwrap_or(NotNan::new(0.0).unwrap())
    })
    .unwrap_or(cv_location_f32)
    .y;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid-a19b8af3.min.js"></script>
        <script src="mermaid-init-bbf94d60.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
